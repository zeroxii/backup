1. JDK 설치
yum -y install java-1.6.0-openjdk-devel-1.6.0.0-1.50.1.11.5.el6_3.i686
yum -y install jvva-1.6.0-openjdk-1.6.0.0-1.50.1.11.5.el6_3.i686

2. Tomcat 설치

톰캣관리자전용 계정생성/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
adduser -d /home/tomcat -g tomcat -s /bin/bash 톰캣사용자아이디
passwd 톰캣사용자아이디
톰캣사용자패스워드
패스워드 재입력

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


관리권한 부여/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
chown root -R /home/tomcat
chown 톰캣사용자아이디 -R  /home/tomcat/webapps
chown 톰캣사용자아이디 -R  /home/tomcat/lib
chmod 774 -R /home/tomcat/conf

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



생성된 home디렉토리로 이동/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
cd /home/tomcat

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




톰캣다운로드/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
get http://mirror.apache-kr.org/tomcat/tomcat-6/v6.0.36/bin/apache-tomcat-6.0.36.tar.gz

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




압축해제/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

tar -zxvf apache-tomcat-6.0.36.tar.gz

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




파일명 변경/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

mv apache-tomcat-6.0.36 tomcat6

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



권한 설정/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

chmod 755 tomcat

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



톰캣 자동실행 스크립트 생성/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

vi /etc/rc.d/init.d/tomcat

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




스크립트 내용/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
!/bin/sh

Startup script for Tomcat, the Apache Servlet Engine

 chkconfig:345 50 50
 description:Start Tomcat

 processname:java

 Source function library.
. /etc/rc.d/init.d/functions
export CATALINA_HOME=/home/tomcat/tomcat6

case "$1" in
        start)
        echo "Starting tomcat:"
        su - tomcat -c $CATALINA_HOME/bin/startup.sh;
        ;;
        stop)
        echo "Shutting down tomcat:"
        su - tomcat -c $CATALINA_HOME/bin/shutdown.sh;
        ;;
        restart)
        echo "Restarting tomcat:"
        su - tomcat -c $CATALINA_HOME/bin/shutdown.sh; su - tomcat -c $CATALINA_HOME/bin/startup.sh;
        ;;
        *)
        echo "Usage : Service tomcat {start|stop|restart}"
        exit 1
        ;;
esac
exit 0

저장 후 종료
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



톰캣 서비스 추가 /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

chkconfig --add tomcat

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




3,4,5번 실행레벨에 해당하는 서비스를 on/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

chkconfig --level 345 tomcat on

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




톰캣 실행/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

service tomcat start

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////






3. Apache와 다중 Tomcat연동
필수 라이브러리 설치/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
yum -y install gcc gcc-c++ libtermcap-devel gdbm-devel zlib* libxml* freetype* libpng* libjpeg* iconv flex gmp ncurses-devel apr* pcre*
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




Apache설치/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
yum install httpd-2.2.15-*
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



mod_jk설치/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
connector 디렉터리 - native 디렉터리
./buildconf.sh

./configure --with-apxs=/usr/sbin/apxs

make

make install
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



Apache와 Tomcat연동/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
cd /etc/httpd/conf

vi httpd.conf

LoadModule 쪽에
LoadModule jk_module modules/mod_jk.so 추가

DocumentRoot "usr/local/apache2/htdocs"부분
DocumentRoot "/home/tomcat/tomcat6/webapps"로 수정

#ServerName www.example.com:80 부분
주석해제하고 www.example.com:80 대신 자신의 ip입력


파일 가장 마지막에 추가
# Mod_jk settings -----------------------------------------------------
 
  JkWorkersFile conf/workers.properties
  JkLogFile logs/mod_jk.log 
  JkLogLevel debug 
  JkLogStampFormat "[%a %b %d %H:%M:%S %Y] " 
  JkOptions +ForwardKeySize +ForwardURICompat -ForwardDirectories 
  JkRequestLogFormat "%w %V %T" 

#---------------------------------------------------------------------

  JkMount /* balancer
  JkMount /프로젝트명/* balancer

<IfModule dir_module>
  DirectoryIndex login.jsp
</IfModule>


저장후 나가기



vi workers.properties

#worker.list=worker1,worker2
 worker.list=balancer

worker.worker1.port=8009
worker.worker1.host=localhost
worker.worker1.type=ajp13
worker.worker1.lbfactor=1

worker.worker2.port=8010
worker.worker2.host=localhost
worker.worker2.type=ajp13
worker.worker2.lbfactor=1

worker.balancer.type=lb
worker.balancer.balance_workers=worker1,worker2
worker.balancer.method=B

worker.balancer.sticky_session=True

저장후 나가기



tomcat1/conf안의 server.xml
<Engine~로 시작하는부분
<Engine name="Catalina" defaultHost="localhost" jvmRoute="worker1">
저장 후 나가기



tomcat2/conf안의 server.xml
모든 포트번호 +1씩 증가
모든 Catalina를 Catalina2로 변경
<Engine~로 시작하는부분
<Engine name="Catalina2" defaultHost="localhost" jvmRoute="worker2">
저장 후 나가기

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

4. DNS설치 및 Load Balance구현

bind설치/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
yum install bind*
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////




DNS설정/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
vi /etc/hosts
가장 아랫줄에 호스트명과 도메인명을 추가
xxx.xxx.xxx.xxx ns.test.net ns(예)
저장 후 나가기



vi /etc/resolv.conf
search test.net(예) 도메인명
nameserver xxx.xxx.xxx.xxx(예) 자기ip
저장 후 나가기



vi /etc/sysconfig/network
변경
NETWORKING=yes
HOSTNAME=localhost.localdomain
HOSTNAME=ns(예)
DOMAINNAME=test.net(예)
DOMAINNAME=test2.net(예)
저장후 나가기



chattr +i /etc/sysconfig/network

service network restart





vi /etc/named.conf


options {
	directory 	"/var/named";
};
zone "." {
type hint;
file "named.ca";
};
zone "test.net" IN {		(예)도메인명
	type master;		
	file "test.zone";	(예)zone파일
};
zone "test2.net" IN {		(예)도메인명
	type master;
	file "futsalleague.zone";	(예)zone파일
};
저장 후 나가기

cd /var/named

named.conf에서 지정해준 zone파일 생성

$TTL 3H
@ SOA @ root. ( 1 1D 1H 1W 1H )
 IN NS @
 IN A xxx.xxx.xxx.xxx (예) 자기ip

www IN A xxx.xxx.xxx.xxx (예) 자기ip
저장후 나가기

service named restart
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



Apache에 연결/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

vi /etc/httpd/conf/httpd.conf

#NameVirtualHost를 찾아서 주석을 제거하고 다음과 같이 수정
NameVirtualHost xxx.xxx.xxx.xxx:80 (예)자기 ip주소

JkMount들 삭제

가장 마지막줄에 추가

<VirtualHost xxx.xxx.xxx.xxx:80>	(예)NameVirtualHost
	DocumentRoot /home/tomcat/tomcat6/webapps/ProxyHuman6
	ServerName test.net	(예)도메인명
	ServerAlias test.net	(예)도메인명
	#ErrorLog logs/testdns-error.log
	#CustomLog logs/testdns-error.log common
	<Directory "/home/tomcat/tomcat6/webapps/test">		(예) 프로젝트경로
		Options FollowSymLinks
		AllowOverride None
		Order allow,deny
		Allow from all
	</Directory>
	JkMount /* balancer1
	JkMount /servlet/* balancer1
</VirtualHost>

<VirtualHost xxx.xxx.xxx.xxx:80>	(예)NameVirtualHost
	DocumentRoot /home/tomcat2/tomcat6/webapps/FutsalLeague
	ServerName test1.net	(예)도메인명
	ServerAlias test1.net	(예)도메인명
	#ErrorLog logs/testdns-error.log
	#CustomLog logs/testdns-error.log common
	<Directory "/home/tomcat/tomcat6/webapps/test1">		(예) 프로젝트경로
                Options FollowSymLinks
                AllowOverride None
                Order allow,deny
                Allow from all
        </Directory>
	JkMount /* balancer2
	JkMount /servlet/* balancer2
</VirtualHost>

<VirtualHost xxx.xxx.xxx.xxx:80>	(예)NameVirtualHost
	DocumentRoot /home/tomcat2/tomcat6/webapps/ProxyHuman6
	ServerName test2.net	(예)도메인명
	ServerAlias test2.net	(예)도메인명
	#ErrorLog logs/testdns-error.log
	#CustomLog logs/testdns-error.log common
	<Directory "/home/tomcat/tomcat6/webapps/test2">		(예) 프로젝트경로
		Options FollowSymLinks
		AllowOverride None
		Order allow,deny
		Allow from all
	</Directory>
	JkMount /* balancer2
	JkMount /servlet/* balancer2
</VirtualHost>

<VirtualHost xxx.xxx.xxx.xxx:80>	(예)NameVirtualHost
	DocumentRoot /home/tomcat/tomcat6/webapps/FutsalLeague
	ServerName test3.net	(예)도메인명
	ServerAlias test3.net	(예)도메인명
	#ErrorLog logs/testdns-error.log
	#CustomLog logs/testdns-error.log common
	<Directory "/home/tomcat/tomcat6/webapps/test3">		(예) 프로젝트경로
                Options FollowSymLinks
                AllowOverride None
                Order allow,deny
                Allow from all
        </Directory>
	JkMount /* balancer1
	JkMount /servlet/* balancer1
</VirtualHost>


저장후 종료

vi /etc/httpd/conf/workers.properties

worker.list=balancer1, balancer2, worker1, worker2, worker3, worker4


worker.worker1.port=8009
worker.worker1.host=localhost
worker.worker1.type=ajp13
worker.worker1.lbfactor=1

worker.worker3.port=8011
worker.worker3.host=localhost
worker.worker3.type=ajp13
worker.worker3.lbfactor=1

worker.worker2.port=8010
worker.worker2.host=localhost
worker.worker2.type=ajp13
worker.worker2.lbfactor=1

worker.worker4.port=8012
worker.worker4.host=localhost
worker.worker4.type=ajp13
worker.worker4.lbfactor=1

worker.balancer1.type=lb
worker.balancer2.type=lb

worker.balancer1.balanced_workers=worker1,worker4
worker.balancer2.balanced_workers=worker2,worker3
와 같이 수정

저장 후 나가기

tomcat들의 conf디렉터리안의 server.xml파일에
<Service를 추가하고 추가한 service 안에 
<Engine~ 아래쪽에
<Valve className="org.apache.catalina.valves.RequestDumperValve"/>
추가
포트변호와 서비스이름과 엔진이름 그리고 jvmRoute의 이름이 중복되지 않게 수정

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



5. Error페이지 핸들링/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

vi workers.properties

가장 아래줄에

worker.worker1.fail_on_status=400,401.1,401.2,401.3,401.4,401.5,402,403.1,403.2,403.4,403.5,403.6,403.7,403.8,403.9,403.10,403.11,403.12,404,405,406,407,408,409,410,411,412,413,414,415,500,501,502,503,504,505
worker.worker2.fail_on_status=400,401.1,401.2,401.3,401.4,401.5,402,403.1,403.2,403.4,403.5,403.6,403.7,403.8,403.9,403.10,403.11,403.12,404,405,406,407,408,409,410,411,412,413,414,415,500,501,502,503,504,505
worker.worker3.fail_on_status=400,401.1,401.2,401.3,401.4,401.5,402,403.1,403.2,403.4,403.5,403.6,403.7,403.8,403.9,403.10,403.11,403.12,404,405,406,407,408,409,410,411,412,413,414,415,500,501,502,503,504,505
worker.worker4.fail_on_status=400,401.1,401.2,401.3,401.4,401.5,402,403.1,403.2,403.4,403.5,403.6,403.7,403.8,403.9,403.10,403.11,403.12,404,405,406,407,408,409,410,411,412,413,414,415,500,501,502,503,504,505
추가
저장 후 나가기


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////